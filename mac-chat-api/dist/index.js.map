{"version":3,"sources":["../src/index.js"],"names":["LocalStrategy","require","Strategy","app","server","createServer","io","use","json","limit","bodyLimit","initialize","Account","usernameField","passwordField","authenticate","serializeUser","deserializeUser","get","req","res","message","typingUsers","on","client","console","log","name","description","newChannel","save","err","channel","emit","id","userName","channelId","messageBody","userId","userAvatar","userAvatarColor","newMessage","msg","timeStamp","listen","port","address","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["import http from 'http';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport socket from 'socket.io';\nimport Message from './model/message';\nimport Channel from './model/channel';\n\nconst LocalStrategy  = require('passport-local').Strategy;\n\nimport config from './config';\nimport routes from './routes';\n\nlet app = express();\napp.server = http.createServer(app);\nlet io = socket(app.server);\n\n//middleware\n//parse application/json\napp.use(bodyParser.json({\n  limit: config.bodyLimit\n}));\n\n//passport config\napp.use(passport.initialize());\nlet Account = require('./model/account');\npassport.use(new LocalStrategy({\n  usernameField: 'email',\n  passwordField: 'password'\n},\n  Account.authenticate()\n));\npassport.serializeUser(Account.serializeUser());\npassport.deserializeUser(Account.deserializeUser());\n\n//api routes v1\napp.use('/v1', routes);\n\n// Base URL test endpoint to see if API is running\napp.get('/', (req, res) => {\n  res.json({ message: 'Chat API is ALIVE!' })\n});\n\n/*||||||||||||||||SOCKET|||||||||||||||||||||||*/\n//Listen for connection\nvar typingUsers = {};\n\nio.on('connection', function(client) {\n  console.log('a user connected');\n  //Listens for a new chat message\n  client.on(\"newChannel\", function(name, description) {\n    //Create channel\n    let newChannel = new Channel({\n    name: name,\n    description: description,\n  });\n    //Save it to database\n    newChannel.save(function(err, channel){\n      //Send message to those connected in the room\n      console.log('new channel created');\n      io.emit(\"channelCreated\", channel.name, channel.description, channel.id);\n    });\n  });\n\n  //Listens for user typing.\n  client.on(\"startType\", function(userName, channelId){\n    console.log(\"User \" + userName + \" is writing a message...\");\n    typingUsers[userName] = channelId;\n    io.emit(\"userTypingUpdate\", typingUsers, channelId);\n  });\n\n  client.on(\"stopType\", function(userName){\n    console.log(\"User \" + userName + \" has stopped writing a message...\");\n    delete typingUsers[userName];\n    io.emit(\"userTypingUpdate\", typingUsers);\n  });\n\n  //Listens for a new chat message\n  client.on('newMessage', function(messageBody, userId, channelId, userName, userAvatar, userAvatarColor) {\n    //Create message\n\n    console.log(messageBody);\n\n    let newMessage = new Message({\n    messageBody: messageBody,\n    userId: userId,\n    channelId: channelId,\n    userName: userName,\n    userAvatar: userAvatar,\n    userAvatarColor: userAvatarColor\n  });\n    //Save it to database\n    newMessage.save(function(err, msg){\n      //Send message to those connected in the room\n      console.log('new message sent');\n\n      io.emit(\"messageCreated\",  msg.messageBody, msg.userId, msg.channelId, msg.userName, msg.userAvatar, msg.userAvatarColor, msg.id, msg.timeStamp);\n    });\n  });\n});\n/*||||||||||||||||||||END SOCKETS||||||||||||||||||*/\n\napp.server.listen(config.port);\nconsole.log(`Started on port ${app.server.address().port}`);\n\nmodule.exports = {\n  app,\n  io\n}\n"]}